<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Body Segment Measurement App</title>
    <link rel="stylesheet" href="styles.css">
    <!-- MediaPipe CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>Body Measurement Tool</h1>
            <p>Measure your body segments using pose detection</p>
        </header>

        <main class="main-content">
            <!-- Height Input Section -->
            <section class="height-input-section">
                <div class="input-group">
                    <label for="height-input">Your Height (cm):</label>
                    <input type="number" id="height-input" placeholder="Enter height in cm" min="100" max="250" step="0.1">
                    <button id="save-height-btn" class="btn btn-primary">Save Height</button>
                </div>
                <div id="height-display" class="height-display"></div>
            </section>

            <!-- Camera Section -->
            <section class="camera-section">
                <div class="camera-container">
                    <video id="camera-video" autoplay playsinline></video>
                    <canvas id="camera-canvas"></canvas>
                    <div class="camera-overlay">
                        <div id="camera-status" class="status-message"></div>
                        <button id="capture-btn" class="btn btn-capture" disabled>Take Photo</button>
                        <button id="start-camera-btn" class="btn btn-primary">Start Camera</button>
                    </div>
                </div>
            </section>

            <!-- Photo Analysis Section -->
            <section class="analysis-section">
                <div class="photo-container">
                    <canvas id="analysis-canvas"></canvas>
                    <div id="analysis-status" class="status-message"></div>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section">
                <h2>Measurements</h2>
                <div id="measurements-display" class="measurements-grid">
                    <div class="measurement-card">
                        <h3>Upper Arm</h3>
                        <span id="upper-arm-measurement" class="measurement-value">-</span>
                    </div>
                    <div class="measurement-card">
                        <h3>Forearm</h3>
                        <span id="forearm-measurement" class="measurement-value">-</span>
                    </div>
                    <div class="measurement-card">
                        <h3>Thigh</h3>
                        <span id="thigh-measurement" class="measurement-value">-</span>
                    </div>
                    <div class="measurement-card">
                        <h3>Shin</h3>
                        <span id="shin-measurement" class="measurement-value">-</span>
                    </div>
                </div>
                <div class="results-actions">
                    <button id="save-results-btn" class="btn btn-secondary" disabled>Save Results</button>
                    <button id="clear-results-btn" class="btn btn-outline">Clear</button>
                </div>
            </section>

            <!-- Saved Results Section -->
            <section class="saved-results-section">
                <h2>Saved Measurements</h2>
                <div id="saved-results-list" class="saved-results-list">
                    <p class="empty-state">No saved measurements yet</p>
                </div>
                <button id="clear-all-btn" class="btn btn-outline">Clear All Saved</button>
            </section>

            <!-- Athletic Tests Section -->
            <section class="athletic-tests-section">
                <h2>Athletic Performance Tests</h2>
                <div class="test-tabs">
                    <button class="tab-btn active" data-test="broad-jump">Standing Broad Jump</button>
                    <button class="tab-btn" data-test="sprint">Sprint Test (30m)</button>
                    <button class="tab-btn" data-test="kick">Kick Power (10m)</button>
                </div>

                <!-- Test Controls -->
                <div class="test-controls">
                    <div class="control-group">
                        <button id="calibrate-btn" class="btn btn-primary">Calibrate Lines</button>
                        <button id="start-test-btn" class="btn btn-secondary" disabled>Start Test</button>
                        <button id="reset-test-btn" class="btn btn-outline">Reset</button>
                    </div>
                    <div class="control-group">
                        <button id="save-test-btn" class="btn btn-success" disabled>Save Result</button>
                        <button id="export-json-btn" class="btn btn-outline">Export JSON</button>
                    </div>
                </div>

                <!-- Test Instructions -->
                <div id="test-instructions" class="test-instructions">
                    <div class="instruction-content" data-test="broad-jump">
                        <h4>Standing Broad Jump Instructions:</h4>
                        <ol>
                            <li>Calibrate by tapping takeoff line and expected landing area</li>
                            <li>Position camera to capture full jump trajectory</li>
                            <li>Start test and perform your jump</li>
                            <li>Measurement finalizes 1 second after landing detection</li>
                        </ol>
                    </div>
                    <div class="instruction-content" data-test="sprint" style="display: none;">
                        <h4>Sprint Test (30m) Instructions:</h4>
                        <ol>
                            <li>Calibrate by tapping 0m, 15m, and 30m markers</li>
                            <li>Position camera for side view of sprint lane</li>
                            <li>Start test and begin sprinting when ready</li>
                            <li>System tracks times at each marker automatically</li>
                        </ol>
                    </div>
                    <div class="instruction-content" data-test="kick" style="display: none;">
                        <h4>Kick Power Test (10m) Instructions:</h4>
                        <ol>
                            <li>Calibrate by tapping 0m and 10m lines</li>
                            <li>Position camera to capture ball trajectory</li>
                            <li>Start test and kick the ball</li>
                            <li>System measures ball speed between markers</li>
                        </ol>
                    </div>
                </div>

                <!-- Test Status -->
                <div id="test-status" class="test-status">
                    <div class="status-indicator">
                        <span id="calibration-status">Not Calibrated</span>
                        <span id="test-progress">Ready</span>
                    </div>
                </div>

                <!-- Results Panel -->
                <div id="test-results-panel" class="test-results-panel">
                    <!-- Broad Jump Results -->
                    <div class="result-content" data-test="broad-jump">
                        <div class="result-metric">
                            <label>Jump Distance:</label>
                            <span id="jump-distance">-</span>
                        </div>
                        <div class="result-metric">
                            <label>Takeoff Speed:</label>
                            <span id="takeoff-speed">-</span>
                        </div>
                    </div>

                    <!-- Sprint Results -->
                    <div class="result-content" data-test="sprint" style="display: none;">
                        <div class="result-metrics-grid">
                            <div class="result-metric">
                                <label>0-15m Split:</label>
                                <span id="split-0-15">-</span>
                            </div>
                            <div class="result-metric">
                                <label>15-30m Split:</label>
                                <span id="split-15-30">-</span>
                            </div>
                            <div class="result-metric">
                                <label>Total Time:</label>
                                <span id="total-time">-</span>
                            </div>
                            <div class="result-metric">
                                <label>Avg Speed (0-30m):</label>
                                <span id="avg-speed-total">-</span>
                            </div>
                            <div class="result-metric">
                                <label>Max Speed:</label>
                                <span id="max-speed">-</span>
                            </div>
                            <div class="result-metric">
                                <label>Avg Accel (0-15m):</label>
                                <span id="avg-accel-0-15">-</span>
                            </div>
                        </div>
                        <div class="speed-chart">
                            <canvas id="speed-chart-canvas" width="300" height="100"></canvas>
                        </div>
                    </div>

                    <!-- Kick Power Results -->
                    <div class="result-content" data-test="kick" style="display: none;">
                        <div class="result-metric">
                            <label>Ball Speed:</label>
                            <span id="ball-speed-ms">-</span>
                        </div>
                        <div class="result-metric">
                            <label>Ball Speed (km/h):</label>
                            <span id="ball-speed-kmh">-</span>
                        </div>
                        <div class="result-metric">
                            <label>Flight Time:</label>
                            <span id="flight-time">-</span>
                        </div>
                    </div>
                </div>

                <!-- Test History -->
                <div class="test-history">
                    <h3>Test History</h3>
                    <div id="test-history-list" class="test-history-list">
                        <p class="empty-state">No test results yet</p>
                    </div>
                    <button id="clear-test-history-btn" class="btn btn-outline">Clear History</button>
                </div>
            </section>
        </main>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-spinner"></div>
            <p>Processing image...</p>
        </div>

        <!-- Error Modal -->
        <div id="error-modal" class="modal">
            <div class="modal-content">
                <h3>Error</h3>
                <p id="error-message"></p>
                <button id="close-error-btn" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/storage.js"></script>
    <script src="js/canvas-renderer.js"></script>
    <script src="js/measurements.js"></script>
    <script src="js/pose-detector.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/lines.js"></script>
    <script src="js/events.js"></script>
    <script src="js/smoothing.js"></script>
    <script src="js/ball-tracker.js"></script>
    <script src="js/exporter.js"></script>
    <script src="js/athletics.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
